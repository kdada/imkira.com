<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>gulp 自动化构建工具 - Kira's Blog</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Kira's Blog" property="og:site_name">
  
    <meta content="gulp 自动化构建工具" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="gulp 工具使用说明" property="og:description">
  
  
    <meta content="/gulp/" property="og:url">
  
  
    <meta content="2016-10-06T04:46:27+00:00" property="article:published_time">
    <meta content="/about/" property="article:author">
  
  
    <meta content="/imkira.com/assets/img/avatar.jpg" property="og:image">
  
  
    
  
  
    
    <meta content="Web" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="gulp 自动化构建工具">
  
  
    <meta name="twitter:url" content="/gulp/">
  
  
    <meta name="twitter:description" content="gulp 工具使用说明">
  
  
    <meta name="twitter:image:src" content="/imkira.com/assets/img/avatar.jpg">
  

	<meta name="description" content="gulp 工具使用说明">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/imkira.com/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/imkira.com/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/imkira.com/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/imkira.com/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/imkira.com/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/imkira.com/assets/css/main.css">
</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/imkira.com/"><img src="/imkira.com/assets/img/avatar.jpg" alt="Wei Guo"></a>
      </div>
      <div class="author-name">Wei Guo</div>
      <p>Author of Nirvana API Framewark. Focus on CloudNative technologies.</p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        
          <li><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        
          <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
        
        
          <li class="github"><a href="http://github.com/kdada" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
          <li class="linkedin"><a href="https://in.linkedin.com/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
        
        
          <li class="email"><a href="mailto:me@imkira.com"><i class="fa fa-envelope-o"></i></a></li>
        
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2019 &copy; Wei Guo</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">gulp 自动化构建工具</h1>
        <div class="page-date"><span>2016, Oct 06&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <h4 id="1gulp-任务定义和执行顺序">1.gulp 任务定义和执行顺序</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// name(string): 任务名称</span>
<span class="c1">// deps(array): 依赖的其他任务数组</span>
<span class="c1">// fn(function): 任务执行函数</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="nx">name</span><span class="p">[,</span> <span class="nx">deps</span><span class="p">],</span> <span class="nx">fn</span><span class="p">)</span>
</code></pre></div></div>
<p>范例：</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">// 创建了 task1 任务, 该任务没有依赖</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">task1</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// task1 的任务执行代码</span>
<span class="p">});</span>

<span class="c1">// 创建了 task3 任务, 该任务没有依赖</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">task3</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// task3 的任务执行代码</span>
<span class="p">});</span>

<span class="c1">// 创建了 task2 任务, 该任务依赖于 task1,task3</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">task2</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">task1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">task3</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// task2 的任务执行代码</span>
<span class="p">});</span>

<span class="c1">// 创建了 newTask 任务, 该任务依赖于 task1,task2,task3</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">newTask</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">task1</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">task2</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">task3</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// newTask 的任务执行代码</span>
<span class="p">});</span>
</code></pre></div></div>
<p>在范例的演示中：task1 和 task3 没有依赖其他任务，task2 依赖于 task1 和 taks3，newTask 依赖于 task1，task2，task3。<br />
在 shell 或 cmd 中使用命令 gulp newTask 执行任务，在上述范例中任务的执行顺序如下：</p>
<ol>
  <li>同时执行 task1 和 task3，但是没有先后顺序之分，即无法确定哪个任务会先执行完毕</li>
  <li>在两个任务都执行完毕后才开始执行 task2</li>
  <li>task2 执行完毕后才会执行 newTask</li>
</ol>

<h4 id="2-文件监控">2. 文件监控</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// glob(string|array): 单个文件路径或文件夹路径字符串或者数组, 使用 ** 表示多级的路径匹配,* 表示任意长度的字符串的匹配</span>
<span class="c1">// opts(object): 传递给 gaze 的选项对象, 参考: https://github.com/shama/gaze</span>
<span class="c1">// tasks(array): 监测到文件变更的时候执行的任务列表</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">glob</span><span class="p">[,</span> <span class="nx">opts</span><span class="p">],</span> <span class="nx">tasks</span><span class="p">)</span>

<span class="c1">// cb(function): 监测到文件变更的时候执行该回调函数</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="nx">glob</span> <span class="p">[,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">cb</span><span class="p">])</span>
</code></pre></div></div>
<p>范例：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 第一种 watch</span>
<span class="kd">var</span> <span class="nx">watcher</span> <span class="o">=</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="dl">'</span><span class="s1">js/**/*.js</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">uglify</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">reload</span><span class="dl">'</span><span class="p">]);</span>
<span class="c1">// 可以通过 on 方法进行事件监听</span>
<span class="nx">watcher</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 监听文件变化事件并做一些处理</span>
<span class="p">});</span>

<span class="c1">// 第二种 watch</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">([</span><span class="dl">'</span><span class="s1">js/**/*.js</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">css/*.css</span><span class="dl">'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 做一些处理或执行任务</span>
<span class="p">});</span>
</code></pre></div></div>
<h4 id="3gulp-流">3.gulp 流</h4>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// glob(string|array): 单个文件路径或文件夹路径字符串或者数组, 使用 ** 表示多级的路径匹配,* 表示任意长度的字符串的匹配</span>
<span class="c1">// options(object):</span>
<span class="c1">//   options.buffer(boolean): 如果该项被设置为 false, 那么将会以 stream 方式返回 file.contents 而不是文件 buffer 的形式 (stream 在处理一些大文件的时候将会很有用, 但是要插件未必会支持 stream)</span>
<span class="c1">//   options.read(boolean): 如果该项被设置为 false, 那么 file.contents 会返回空值 (null), 这种情况适合于只需要知道文件路径而不需要文件内容的时候</span>
<span class="c1">//   options.base(string): 改变 globs 中的文件路径的 base 路径, 默认情况下 base 是从第一个通配符出现之前的路径部分, 对应 gulp.dest 的输出</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">globs</span><span class="p">[,</span> <span class="nx">options</span><span class="p">])</span>

<span class="c1">// path(string): 输出路径</span>
<span class="c1">// options(object):</span>
<span class="c1">//   options.cwd(string):Change Working Directory, 用于设置 path 工作目录, 只有 path 是相对路径时有效</span>
<span class="c1">//   options.mode(string): 用于设置目录权限, 默认 "0777"</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="nx">path</span><span class="p">[,</span> <span class="nx">options</span><span class="p">])</span>
</code></pre></div></div>
<p>范例：</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 定义任务并执行</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">task1</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 获取 js 目录和子目录下所有的 js 文件, 使用 pipe 可以将文件传递到各种插件中执行操作, 最后用 dest 输出</span>
  <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="dl">'</span><span class="s1">web/js/**/*.js</span><span class="dl">'</span><span class="p">,{</span><span class="na">base</span><span class="p">:</span><span class="dl">'</span><span class="s1">web</span><span class="dl">'</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="dl">'</span><span class="s1">build</span><span class="dl">'</span><span class="p">));</span>    <span class="c1">// 将文件输出到 dest/js/**/*.js</span>
<span class="p">});</span>
</code></pre></div></div>
<p>上面使用了 base 属性，展示了当设置 base 时输出的路径结构：</p>
<ol>
  <li>默认情况下,’web/js/**/*.js’对应的 base 是’web/js’, 即最终会输出到 build/**/*.js 中</li>
  <li>通过 base 改变了目录后, 输出到 build/js/**/*.js 中</li>
</ol>

<h4 id="4-单-task-多-stream">4. 单 task 多 stream</h4>
<p>有时候需要实现在同一个任务中执行多个流，并且等待所有流完成才表示任务完成，此时可以引入 Q 包。</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Q</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">q</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="dl">'</span><span class="s1">task1</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 要处理的文件或其他内容</span>
    <span class="kd">var</span> <span class="nx">srcs</span> <span class="o">=</span> <span class="p">{...}</span>
    <span class="c1">//defer 数组</span>
    <span class="kd">var</span> <span class="nx">ds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">file</span> <span class="k">in</span> <span class="nx">srcs</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 创建并添加 defer 对象</span>
        <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">()</span>
        <span class="nx">ds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">promise</span><span class="p">)</span>
        <span class="c1">// 处理任务</span>
        <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">srcs</span><span class="p">[</span><span class="nx">file</span><span class="p">]</span>
        <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">pipe</span><span class="p">(...)</span><span class="c1">// 执行相关插件</span>
            <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">end</span><span class="dl">"</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">resolve</span><span class="p">)</span><span class="c1">// 结束时执行 d.resolve() 表示完成</span>
    <span class="p">}</span>
    <span class="c1">// 返回一个合并的 promise</span>
    <span class="k">return</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">ds</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<h6 id="常用插件">常用插件：</h6>
<ul>
  <li>gulp-html-replace：用于替换 html 中的内容</li>
  <li>gulp-concat：合并文件</li>
  <li>gulp-uglify：代码丑化（混淆）</li>
  <li>gulp-md5-plus：文件加 md5 后缀，防止浏览器缓存</li>
  <li>gulp-clean-css：压缩 CSS</li>
  <li>gulp-rename：文件重命名</li>
  <li>gulp-clean：清理文件和文件夹</li>
</ul>

      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=gulp 自动化构建工具&url=/gulp/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=/gulp/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=/gulp/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
            <a href="/imkira.com/tags#Web" class="tag">&#35; Web</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
